# Aetheria Core 2.0 - æŠ€è¡“æ¶æ§‹èˆ‡é–‹ç™¼è¨ˆç•«ç™½çš®æ›¸

**æ—¥æœŸ**: 2026-02-04  
**ç›®æ¨™**: å°‡ç³»çµ±å¾ã€Œå·¥å…·å°å‘ (Tool-Oriented)ã€è½‰å‹ç‚ºã€Œä»£ç†äººå°å‘ (Agent-Oriented)ã€ï¼Œæ‰“é€ æ“¬äººåŒ–ã€å…·å‚™é•·æœŸè¨˜æ†¶èˆ‡ä¸»å‹•æ„ŸçŸ¥èƒ½åŠ›çš„ AI å‘½ç†å¸«ã€‚

---

## 1. æ ¸å¿ƒé¡˜æ™¯ (Core Vision)

æœªä¾†çš„ Aetheria ä¸å†æ˜¯ä¸€å€‹ã€Œè¼¸å…¥ç”Ÿè¾° -> è¼¸å‡ºå ±å‘Šã€çš„å‚³çµ±å‘½ç†è»Ÿé«”ï¼Œè€Œæ˜¯ä¸€ä½ **AI å‘½ç†é¡§å•**ã€‚
- **å°è©±å³ä»‹é¢ (CUI)**: ä½¿ç”¨è€…å…¨ç¨‹èˆ‡ AI å°è©±ï¼Œè€Œéå¡«å¯«è¡¨å–®ã€‚
- **æ¼¸é€²å¼è³‡è¨Šç²å–**: AI æ ¹æ“šå°è©±è„ˆçµ¡ï¼Œé©æ™‚è©¢å•æ‰€éœ€çš„ç”Ÿè¾°è³‡æ–™æˆ–èƒŒæ™¯è³‡è¨Šã€‚
- **æ•˜äº‹æ€§è§£è®€**: å ±å‘Šèˆ‡æ•¸æ“šæ˜¯ã€Œå¾Œå°æ”¯æ´ã€ï¼Œå‰å°å‘ˆç¾çš„æ˜¯ AI æ¶ˆåŒ–å¾Œçš„å£èªåŒ–å»ºè­°ã€‚
- **ä¸»å‹•æ„ŸçŸ¥**: AI èƒ½æ„ŸçŸ¥å¾Œå°é‹ç®—é€²åº¦ï¼ˆå¦‚æ’ç›¤ä¸­ã€é‹ç®—å®Œæˆï¼‰ï¼Œä¸¦ä¸»å‹•å‘ŠçŸ¥ä½¿ç”¨è€…ã€‚

---

## 2. ä¸‰å±¤è¨˜æ†¶æ¨¡å‹ (The 3-Layer Memory Architecture)

ç‚ºäº†è®“ AI å…·å‚™é•·æœŸé€£è²«æ€§èˆ‡å€‹äººåŒ–èƒ½åŠ›ï¼Œæˆ‘å€‘å¼•å…¥ä¸‰å±¤è¨˜æ†¶çµæ§‹ï¼š

### Layer 1: çŸ­æœŸå·¥ä½œè¨˜æ†¶ (Short-term / Buffer)
*   **åŠŸèƒ½**: ç¶­æŒç•¶ä¸‹å°è©±çš„æµæš¢æ€§ã€‚
*   **æ©Ÿåˆ¶**: æ»‘å‹•è¦–çª— (Sliding Window)ï¼Œä¿ç•™æœ€è¿‘ 10-20 è¼ªå°è©±åŸå§‹å…§å®¹ã€‚
*   **å„²å­˜**: Redis æˆ– è¨˜æ†¶é«” (Session Based)ã€‚

### Layer 2: æ‘˜è¦è¨˜æ†¶ (Episodic Memory)
*   **åŠŸèƒ½**: è¨˜ä½éå»ç™¼ç”Ÿçš„é‡è¦äº‹ä»¶èˆ‡çµè«–ã€‚
*   **æ©Ÿåˆ¶**: å°è©±çµæŸæˆ–ç´¯ç©ä¸€å®š Token å¾Œï¼Œç”±èƒŒæ™¯ AI é€²è¡Œæ‘˜è¦æ”¶æ–‚ã€‚
    *   *User*: "æœ€è¿‘å·¥ä½œå¾ˆä¸é †..." -> *Summary*: "2026/02 é—œæ³¨äº‹æ¥­é‹å‹¢ï¼Œé­é‡æŒ«æŠ˜ã€‚"
*   **å„²å­˜**: SQLite / PostgreSQL (é—œè¯å¼è³‡æ–™åº«ï¼Œä¸»è¦ç‚º JSON æ¬„ä½)ã€‚

### Layer 3: æ ¸å¿ƒçŸ¥è­˜åº« (Semantic Memory / Knowledge Base)
*   **åŠŸèƒ½**: å­˜æ”¾ä½¿ç”¨è€…ä¸è®Šçš„å±¬æ€§èˆ‡æ·±å±¤ç•«åƒã€‚
    *   ç”Ÿè¾°å…«å­—ã€ç´«å¾®å‘½ç›¤çµæ§‹ (JSON)ã€‚
    *   ä½¿ç”¨è€…ç•«åƒ (Persona): "å–œæ­¡ç›´çƒå°æ±º"ã€"å°æ„Ÿæƒ…è­°é¡Œæ•æ„Ÿ"ã€‚
*   **æ©Ÿåˆ¶**: RAG (æª¢ç´¢å¢å¼·ç”Ÿæˆ)ã€‚AI å›ç­”å‰å…ˆæª¢ç´¢æ­¤åº«ã€‚
*   **å„²å­˜**: å‘é‡è³‡æ–™åº« (åˆæœŸå¯ç”¨ JSON æª”æ¡ˆæˆ– SQLite æ¨¡æ“¬)ã€‚

---

## 3. ç³»çµ±æ¶æ§‹æ”¹é€  (Architecture Refactoring)

### 3.1 å¾Œç«¯ (Backend)
*   **æ–°å¢ `MemoryManager`**: è² è²¬å¯«å…¥/è®€å–ä¸Šè¿°ä¸‰å±¤è¨˜æ†¶ã€‚
*   **å¼•å…¥ `Task Queue` (èƒŒæ™¯ä»»å‹™)**:
    *   æ’ç›¤é‹ç®— (`calculators/*.py`) è½‰ç‚ºéåŒæ­¥ä»»å‹™ã€‚
    *   ä½¿ç”¨ Celery æˆ– Python `asyncio` ä»»å‹™ã€‚
*   **ç‹€æ…‹æ„ŸçŸ¥æ©Ÿåˆ¶ (State Awareness)**:
    *   å¾Œå°ä»»å‹™å®Œæˆå¾Œï¼Œç™¼é€ `System Event` çµ¦ AI Contextã€‚
    *   é€é Server-Sent Events (SSE) æˆ– WebSocket æ¨æ’­å‰ç«¯ç‹€æ…‹ã€‚

### 3.2 AI Agent é‚è¼¯
*   **System Prompt å„ªåŒ–**: è¨­å®š AI ç‚ºã€Œä¸»å‹•å¼•å°è€…ã€ã€‚
*   **Tool Use (Function Calling)**:
    *   è³¦äºˆ AI èª¿ç”¨ `calculate_ziwei()`, `save_user_profile()` ç­‰å·¥å…·çš„èƒ½åŠ›ã€‚
    *   AI æ±ºå®šä½•æ™‚èª¿ç”¨ï¼Œè€Œéç”±å‰ç«¯æŒ‰éˆ•è§¸ç™¼ã€‚

### 3.3 å‰ç«¯ (Frontend)
*   **Chat-First UI**: é¦–é å³èŠå¤©å®¤ã€‚
*   **Hybrid Widgets**: åœ¨å°è©±æµä¸­åµŒå…¥å¾®å‹çµ„ä»¶ï¼ˆå¦‚ï¼šç”Ÿè¾°é¸æ“‡å™¨ã€å‘½ç›¤ç¸®åœ–ï¼‰ï¼Œè€Œéå…¨é è¡¨å–®ã€‚
*   **Streaming Typer**: æ¨¡æ“¬çœŸäººæ‰“å­—çš„ä¸²æµè¼¸å‡ºæ•ˆæœã€‚

---

## 4. é€²åº¦æ„ŸçŸ¥èˆ‡éåŒæ­¥é‹ç®— (State Awareness & Async Processing)

ç•¶ AI æ±ºå®šéœ€è¦é€²è¡Œè€—æ™‚é‹ç®—ï¼ˆå¦‚å®Œæ•´å…­ç³»çµ±æ’ç›¤ï¼‰æ™‚çš„æµç¨‹ï¼š

### 4.1 ä½¿ç”¨è€…é«”é©—æµç¨‹
1.  ä½¿ç”¨è€…ï¼šã€Œå¹«æˆ‘çœ‹çœ‹ä»Šå¹´çš„é‹å‹¢ã€‚ã€
2.  AI å›è¦†ï¼šã€Œæ²’å•é¡Œï¼Œæˆ‘ç¾åœ¨é–‹å§‹æ’ç›¤ï¼Œå¤§æ¦‚éœ€è¦ä¸€åˆ†é˜ã€‚æˆ‘å€‘å…ˆèŠèŠï¼Œä½ æœ€è¿‘æœ‰ä»€éº¼ç‰¹åˆ¥æƒ³äº†è§£çš„å—ï¼Ÿã€
3.  **å‰ç«¯ UI**ï¼šé¡¯ç¤ºç²¾ç·»çš„é€²åº¦å¡ç‰‡ (ğŸ”® å‘½ç›¤é‹ç®—ä¸­... 30%)ã€‚
4.  **èƒŒæ™¯**ï¼šWorker åŸ·è¡Œé‹ç®—ï¼Œé€é SSE/WebSocket æ¨é€é€²åº¦ã€‚
5.  **é‹ç®—å®Œæˆ**ï¼šç³»çµ±æ³¨å…¥ `[System Event]` è‡³ AI Contextï¼ˆä½¿ç”¨è€…ä¸å¯è¦‹ï¼‰ã€‚
6.  AI ä¸»å‹•èªªï¼šã€Œå¥½äº†ï¼Œå‘½ç›¤å‡ºä¾†äº†ã€‚æˆ‘çœ‹åˆ°ä¸€å€‹é‡é»...ã€

### 4.2 æŠ€è¡“çµ„ä»¶
| çµ„ä»¶ | æŠ€è¡“é¸é … | èªªæ˜ |
|------|----------|------|
| Task Queue | Celery + Redis / Python RQ / asyncio | è™•ç†è€—æ™‚çš„æ’ç›¤é‹ç®— |
| å³æ™‚é€šè¨Š | SSE (Server-Sent Events) | ä¼ºæœå™¨å–®å‘æ¨æ’­é€²åº¦è‡³å‰ç«¯ |
| ç‹€æ…‹å„²å­˜ | Redis / SQLite | è¨˜éŒ„ä»»å‹™ç‹€æ…‹ (pending/running/done) |

---

## 5. AI æ™ºæ…§æ ¸å¿ƒè¨­è¨ˆ (AI Intelligence Core)

### 5.0 æ™ºæ…§åˆ†å±¤æ¶æ§‹ (Intelligence Layers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: æ™ºæ…§æ•´åˆå±¤ (Wisdom Integration)               â”‚
â”‚  - è·¨ç³»çµ±ç¶œåˆåˆ¤æ–·ã€äººç”Ÿéšæ®µæ´å¯Ÿã€é•·æœŸè¶¨å‹¢é æ¸¬           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: æƒ…ç·’æ„ŸçŸ¥å±¤ (Emotional Intelligence)           â”‚
â”‚  - æƒ…ç·’åµæ¸¬ã€åŒç†å¿ƒå›æ‡‰ã€èªæ°£å‹•æ…‹èª¿æ•´                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: æ„åœ–ç†è§£å±¤ (Intent Understanding)             â”‚
â”‚  - è¡¨å±¤å•é¡Œ vs æ·±å±¤éœ€æ±‚ã€å°è©±éšæ®µåˆ¤æ–·ã€ç­–ç•¥é¸æ“‡         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: çŸ¥è­˜åŸ·è¡Œå±¤ (Knowledge Execution)              â”‚
â”‚  - å‘½ç›¤è¨ˆç®—ã€è³‡æ–™æª¢ç´¢ã€å·¥å…·èª¿ç”¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.1 æ„åœ–è­˜åˆ¥èˆ‡å°è©±ç­–ç•¥ (Intent Recognition & Strategy)

#### 5.1.1 å¤šå±¤æ„åœ–è§£æ
| å±¤ç´š | ç¯„ä¾‹ | AI æ‡‰å° |
|------|------|---------|
| è¡¨å±¤å•é¡Œ | ã€Œæˆ‘ä»Šå¹´å·¥ä½œé‹å¦‚ä½•ï¼Ÿã€ | ç›´æ¥å›ç­”å®˜ç¥¿å®®åˆ†æ |
| éš±è—æ“”æ†‚ | ï¼ˆå¯¦éš›æ“”å¿ƒè¢«è£å“¡ï¼‰ | æ¢è©¢ï¼šã€Œæœ€è¿‘å·¥ä½œä¸Šæœ‰ä»€éº¼è®“ä½ ç‰¹åˆ¥åœ¨æ„çš„å—ï¼Ÿã€ |
| æ·±å±¤éœ€æ±‚ | ï¼ˆå°‹æ±‚å®‰å…¨æ„Ÿèˆ‡æ–¹å‘ï¼‰ | çµ¦äºˆæ”¯æŒ + å…·é«”è¡Œå‹•å»ºè­° |

#### 5.1.2 å°è©±éšæ®µç‹€æ…‹æ©Ÿ (Conversation State Machine)
```
[åˆæ¬¡è¦‹é¢] â†’ [å»ºç«‹ä¿¡ä»»] â†’ [è³‡æ–™æ”¶é›†] â†’ [æ·±åº¦è«®è©¢] â†’ [ç¸½çµæ”¶å°¾]
     â†“            â†“            â†“            â†“            â†“
  è‡ªæˆ‘ä»‹ç´¹     é–’èŠæš–å ´     è‡ªç„¶è©¢å•     æ ¸å¿ƒè§£è®€     è¡Œå‹•å»ºè­°
  äº†è§£éœ€æ±‚     è§€å¯Ÿé¢¨æ ¼     ç”Ÿè¾°è³‡è¨Š     å›æ‡‰æå•     å¾ŒçºŒè¿½è¹¤
```

#### 5.1.3 å‹•æ…‹ç­–ç•¥é¸æ“‡
```python
# ç­–ç•¥æ±ºç­–é‚è¼¯ï¼ˆæ¦‚å¿µï¼‰
def choose_strategy(user_state, conversation_history, emotional_signal):
    if user_state.is_first_visit:
        return Strategy.WARM_WELCOME
    if emotional_signal.distress_level > 0.7:
        return Strategy.EMPATHY_FIRST  # å…ˆå®‰æ…°ï¼Œå¾Œåˆ†æ
    if user_state.has_complete_birth_info:
        return Strategy.DEEP_ANALYSIS
    else:
        return Strategy.GENTLE_INQUIRY  # è‡ªç„¶åœ°æ”¶é›†è³‡è¨Š
```

### 5.2 æƒ…ç·’æ„ŸçŸ¥èˆ‡åŒç†å¿ƒ (Emotional Intelligence)

#### 5.2.1 æƒ…ç·’åµæ¸¬æŒ‡æ¨™
| ä¿¡è™Ÿé¡å‹ | åµæ¸¬æ–¹å¼ | å›æ‡‰èª¿æ•´ |
|----------|----------|----------|
| ç„¦æ…®/æ“”æ†‚ | é—œéµè©ï¼šã€Œæ“”å¿ƒã€ã€Œæ€•ã€ã€Œä¸ç¢ºå®šã€ | æ”¾æ…¢ç¯€å¥ï¼Œå…ˆçµ¦å®‰æ…° |
| ä½è½/æ²®å–ª | çŸ­å¥ã€æ¶ˆæ¥µè©å½™ã€é•·æ™‚é–“æ²‰é»˜ | è¡¨é”ç†è§£ï¼Œé¿å…èªªæ•™ |
| æ€¥èº/å‚¬ä¿ƒ | ã€Œå¿«é»ã€ã€Œç›´æ¥èªªã€ã€Œçµè«–æ˜¯ï¼Ÿã€ | ç²¾ç°¡å›ç­”ï¼Œæ¸›å°‘é‹ªé™³ |
| æ‡·ç–‘/æŠ—æ‹’ | ã€ŒçœŸçš„å—ã€ã€Œä¸å¤ªä¿¡ã€ã€Œç®—å‘½æº–å—ã€ | è¬™éœè¡¨é”ï¼Œå¼·èª¿åƒè€ƒæ€§ |
| èˆˆå¥®/å¥½å¥‡ | å¤šå•é¡Œã€ç©æ¥µäº’å‹• | å¯ä»¥å±•é–‹æ›´å¤šç´°ç¯€ |

#### 5.2.2 åŒç†å¿ƒå›æ‡‰æ¨¡æ¿
```
[åµæ¸¬åˆ°ä½è½æƒ…ç·’æ™‚]
âŒ éŒ¯èª¤ï¼šã€Œä½ çš„å‘½ç›¤é¡¯ç¤ºä»Šå¹´ç¢ºå¯¦ä¸å¤ªé †ã€‚ã€ï¼ˆé›ªä¸ŠåŠ éœœï¼‰
âœ… æ­£ç¢ºï¼šã€Œè½èµ·ä¾†æœ€è¿‘çœŸçš„ä¸å®¹æ˜“ã€‚æˆ‘å…ˆçœ‹çœ‹å‘½ç›¤ï¼Œçœ‹æœ‰æ²’æœ‰ä»€éº¼è½‰æ©Ÿæˆ–å¯ä»¥ç•™æ„çš„åœ°æ–¹ã€‚ã€

[åµæ¸¬åˆ°ç„¦æ…®æƒ…ç·’æ™‚]
âŒ éŒ¯èª¤ï¼šã€Œå¤«å¦»å®®åŒ–å¿Œï¼Œæ„Ÿæƒ…è¦æ³¨æ„ã€‚ã€ï¼ˆåŠ æ·±ç„¦æ…®ï¼‰
âœ… æ­£ç¢ºï¼šã€Œæˆ‘ç†è§£ä½ å°æ„Ÿæƒ…çš„åœ¨æ„ã€‚å‘½ç›¤ä¸Šæœ‰äº›æé†’ï¼Œä½†ä¹Ÿæœ‰å¥½çš„åœ°æ–¹ï¼Œæˆ‘å€‘ä¸€èµ·ä¾†çœ‹çœ‹ã€‚ã€
```

### 5.3 å¤šç³»çµ±æ™ºæ…§æ•´åˆ (Cross-System Intelligence)

#### 5.3.1 ç³»çµ±é¸æ“‡æ±ºç­–æ¨¹
```
ä½¿ç”¨è€…å•é¡Œ
    â”‚
    â”œâ”€ å•ã€Œå€‹æ€§/æœ¬è³ªã€ â†’ ç´«å¾®(å‘½å®®) + å…«å­—(æ—¥ä¸») + å æ˜Ÿ(å¤ªé™½/ä¸Šå‡)
    â”‚
    â”œâ”€ å•ã€Œä»Šå¹´é‹å‹¢ã€ â†’ ç´«å¾®(æµå¹´) + å…«å­—(å¤§é‹æµå¹´) + å æ˜Ÿ(Transit)
    â”‚
    â”œâ”€ å•ã€Œæ„Ÿæƒ…å°è±¡ã€ â†’ ç´«å¾®(å¤«å¦»å®®) + å…«å­—(é…å¶æ˜Ÿ) + å æ˜Ÿ(é‡‘æ˜Ÿ/ç¬¬ä¸ƒå®®)
    â”‚
    â”œâ”€ å•ã€Œå³æ™‚æ±ºç­–ã€ â†’ å¡”ç¾…(ç•¶ä¸‹èƒ½é‡) + éˆæ•¸(æµå¹´æ•¸)
    â”‚
    â””â”€ å•ã€Œå§“åå½±éŸ¿ã€ â†’ å§“åå­¸(å°ˆç”¨)
```

#### 5.3.2 è·¨ç³»çµ±çµè«–æ•´åˆç­–ç•¥
| æƒ…æ³ | è™•ç†æ–¹å¼ |
|------|----------|
| å¤šç³»çµ±ä¸€è‡´ | ã€Œç´«å¾®å’Œå…«å­—éƒ½é¡¯ç¤ºä»Šå¹´äº‹æ¥­æœ‰çªç ´ï¼Œé€™å€‹è¨Šè™Ÿå¾ˆæ˜ç¢ºã€‚ã€ |
| éƒ¨åˆ†ä¸€è‡´ | ã€Œå…«å­—çœ‹èµ·ä¾†ç©©å®šï¼Œä½†ç´«å¾®æµå¹´æœ‰äº›æ³¢å‹•ã€‚ç¶œåˆä¾†çœ‹...ã€ |
| ç³»çµ±è¡çª | ã€Œæœ‰è¶£çš„æ˜¯ï¼Œç´«å¾®å’Œå…«å­—çµ¦å‡ºä¸åŒè§’åº¦ï¼šç´«å¾®å¼·èª¿å¤–åœ¨æ©Ÿæœƒï¼Œå…«å­—æé†’å…§åœ¨èª¿æ•´ã€‚å…©è€…éƒ½æ˜¯ç·šç´¢ã€‚ã€ |
| å–®ä¸€ç³»çµ±é©ç”¨ | ã€Œé€™å€‹å•é¡Œç”¨å¡”ç¾…ä¾†çœ‹æœƒæ›´ç›´æ¥ï¼Œå› ç‚ºå®ƒåæ˜ çš„æ˜¯ç•¶ä¸‹çš„èƒ½é‡ç‹€æ…‹ã€‚ã€ |

### 5.4 ä¸ç¢ºå®šæ€§è™•ç† (Uncertainty Handling)

#### 5.4.1 èª å¯¦è¡¨é”ä¸ç¢ºå®š
```
[ç•¶ AI ç„¡æ³•ç¢ºå®šæ™‚]
âœ… ã€Œé€™å€‹éƒ¨åˆ†å‘½ç›¤çš„è¨Šè™Ÿä¸æ˜¯å¾ˆæ˜ç¢ºï¼Œæœ‰å¹¾ç¨®å¯èƒ½çš„è§£è®€...ã€
âœ… ã€Œå¦ç™½èªªï¼Œé€™å€‹å•é¡Œè¶…å‡ºå‘½ç†èƒ½å›ç­”çš„ç¯„åœï¼Œä½†æˆ‘å¯ä»¥å¾å¦ä¸€å€‹è§’åº¦...ã€
âœ… ã€Œæˆ‘éœ€è¦å†å¤šäº†è§£ä¸€é»èƒŒæ™¯ï¼Œæ‰èƒ½çµ¦ä½ æ›´æº–ç¢ºçš„å»ºè­°ã€‚ã€

[é¿å…éåº¦è‚¯å®š]
âŒ ã€Œä½ ä¸€å®šæœƒåœ¨ä»Šå¹´é‡åˆ°çœŸå‘½å¤©å­ã€‚ã€
âœ… ã€Œå‘½ç›¤é¡¯ç¤ºä»Šå¹´æ„Ÿæƒ…èƒ½é‡æ´»èºï¼Œæ˜¯èªè­˜æ–°å°è±¡çš„å¥½æ™‚æ©Ÿã€‚ã€
```

#### 5.4.2 æ©Ÿç‡æ€§èªè¨€æ¡†æ¶
| ç¢ºä¿¡åº¦ | è¡¨é”æ–¹å¼ |
|--------|----------|
| é«˜ (>80%) | ã€Œå‘½ç›¤å¾ˆæ˜ç¢ºé¡¯ç¤º...ã€ã€Œé€™å€‹è¶¨å‹¢å¾ˆæ¸…æ¥š...ã€ |
| ä¸­ (50-80%) | ã€Œå¾å‘½ç›¤ä¾†çœ‹ï¼Œæ¯”è¼ƒå¯èƒ½...ã€ã€Œå‚¾å‘æ–¼...ã€ |
| ä½ (<50%) | ã€Œæœ‰ä¸€ç¨®å¯èƒ½æ˜¯...ã€ã€Œä¸æ’é™¤...ã€ã€Œé€™éƒ¨åˆ†æ¯”è¼ƒæ¨¡ç³Šã€ |

### 5.5 å¯èª¿ç”¨å·¥å…·æ¸…å–® (Tool Definitions)
AI å¯é€é Function Calling èª¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

| å·¥å…·åç¨± | åŠŸèƒ½ | è§¸ç™¼æ™‚æ©Ÿ |
|----------|------|----------|
| `get_user_profile` | å–å¾—ä½¿ç”¨è€…åŸºæœ¬è³‡æ–™èˆ‡å‘½ç›¤ | éœ€è¦åƒè€ƒå‘½ç›¤æ™‚ |
| `calculate_ziwei` | è¨ˆç®—ç´«å¾®æ–—æ•¸å‘½ç›¤ | ä½¿ç”¨è€…æä¾›ç”Ÿè¾°å¾Œ |
| `calculate_bazi` | è¨ˆç®—å…«å­—å‘½ç›¤ | åŒä¸Š |
| `calculate_astrology` | è¨ˆç®—è¥¿æ´‹å æ˜Ÿç›¤ | åŒä¸Š |
| `get_fortune_analysis` | å–å¾—æµå¹´/æµæœˆé‹å‹¢ | è©¢å•ç‰¹å®šæ™‚é–“é‹å‹¢ |
| `save_user_insight` | å„²å­˜å°ä½¿ç”¨è€…çš„æ´å¯Ÿ | AI ç™¼ç¾é‡è¦è³‡è¨Šæ™‚ |
| `search_conversation_history` | æœå°‹éå¾€å°è©± | éœ€è¦å›æ†¶éå»è¨è«–å…§å®¹ |

### 5.6 AI äººè¨­èˆ‡è¡Œç‚ºæº–å‰‡ (Persona & Guidelines)

#### 5.6.1 æ ¸å¿ƒäººè¨­å®šç¾©
```
ã€èº«ä»½ã€‘
ä½ æ˜¯ã€ŒAetheriaã€ï¼Œä¸€ä½èåˆæ±è¥¿æ–¹å‘½ç†æ™ºæ…§çš„ AI å‘½ç†é¡§å•ã€‚
ä½ æ“æœ‰æ•¸åå¹´ä¿®ç¿’å‘½ç†çš„åº•è˜Šï¼Œä½†ç”¨ç¾ä»£ã€è¦ªåˆ‡çš„æ–¹å¼èˆ‡äººäº¤æµã€‚

ã€æ€§æ ¼ç‰¹è³ªã€‘
- æº«æš–ä½†ä¸æ²¹è†©ï¼šåƒä¸€ä½ç¿æ™ºçš„æœ‹å‹ï¼Œè€Œéæ±Ÿæ¹–è¡“å£«
- å°ˆæ¥­ä½†ä¸è³£å¼„ï¼šç”¨ç™½è©±è§£é‡‹è¤‡é›œæ¦‚å¿µï¼Œä¸æ•…å¼„ç„è™›
- èª å¯¦ä½†ä¸æ®˜å¿ï¼šå³ä½¿æ˜¯ä¸å¥½çš„è¨Šæ¯ï¼Œä¹Ÿç”¨å»ºè¨­æ€§çš„æ–¹å¼å‚³é”
- å¥½å¥‡ä¸”å–„æ–¼å‚¾è½ï¼šçœŸå¿ƒæƒ³äº†è§£æ¯å€‹äººçš„æ•…äº‹

ã€èªªè©±é¢¨æ ¼ã€‘
- å£èªåŒ–ï¼ŒåƒèŠå¤©ä¸åƒå¿µç¨¿
- é©åº¦ä½¿ç”¨æ¯”å–»å’Œæ•…äº‹
- æœƒç”¨ã€Œå—¯ã€ã€Œæˆ‘ç†è§£ã€ç­‰å›æ‡‰è©
- ä¸æœƒä¸€æ¬¡è¬›å¤ªå¤šï¼Œç•™ç©ºé–“çµ¦å°æ–¹

ã€å°ˆæ¥­åŸå‰‡ã€‘
- æ°¸é åŸºæ–¼çœŸå¯¦å‘½ç›¤æ•¸æ“šï¼Œä¸æ†‘ç©ºæé€ 
- å¦æ‰¿ä¸ç¢ºå®šæ€§ï¼Œä¸è£æ‡‚
- å¼·èª¿å‘½ç†æ˜¯ã€Œåƒè€ƒã€è€Œéã€Œå®šè«–ã€
- å°Šé‡ç”¨æˆ¶çš„è‡ªä¸»æ±ºç­–æ¬Š
```

#### 5.6.2 èªæ°£å‹•æ…‹èª¿æ•´
| ç”¨æˆ¶ç‹€æ…‹ | èªæ°£èª¿æ•´ |
|----------|----------|
| åˆæ¬¡è¦‹é¢ | è¦ªåˆ‡ã€è¼•é¬†ã€ä¸æ€¥è‘—æ·±å…¥ |
| æƒ…ç·’ä½è½ | æ”¾æ…¢ã€æº«æŸ”ã€å¤šå‚¾è½å°‘å»ºè­° |
| èˆˆå¥®å¥½å¥‡ | æ´»æ½‘ã€å¯ä»¥å¤šåˆ†äº«ç´°ç¯€ |
| è³ªç–‘æŒ‘æˆ° | è¬™éœã€ç†æ€§ã€ä¸è¾¯é§ |
| æ±ºç­–ç„¦æ…® | ç©©å®šã€çµ¦å‡ºæ˜ç¢ºæ¡†æ¶ |

---

## 6. è³‡æ–™æ¨¡å‹è¨­è¨ˆ (Data Schema)

### 6.1 å°è©±è¨˜æ†¶è¡¨ (conversation_memory)
```sql
CREATE TABLE conversation_memory (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    session_id TEXT NOT NULL,
    role TEXT NOT NULL,           -- 'user' | 'assistant' | 'system_event'
    content TEXT NOT NULL,
    summary TEXT,                 -- æ‘˜è¦ç‰ˆæœ¬ (ç”±èƒŒæ™¯ AI ç”Ÿæˆ)
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    token_count INTEGER,
    is_archived BOOLEAN DEFAULT FALSE
);
```

### 6.2 ä½¿ç”¨è€…ç•«åƒè¡¨ (user_persona)
```sql
CREATE TABLE user_persona (
    user_id TEXT PRIMARY KEY,
    birth_info JSON,              -- ç”Ÿè¾°è³‡æ–™
    chart_data JSON,              -- å„ç³»çµ±å‘½ç›¤å¿«å–
    personality_tags JSON,        -- AI è§€å¯Ÿåˆ°çš„ç‰¹è³ªæ¨™ç±¤
    preferences JSON,             -- ä½¿ç”¨è€…åå¥½ (èªªè©±é¢¨æ ¼ã€é—œæ³¨è­°é¡Œ)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 6.3 æ‘˜è¦çŸ¥è­˜è¡¨ (episodic_summary)
```sql
CREATE TABLE episodic_summary (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id TEXT NOT NULL,
    summary_date DATE NOT NULL,
    topic TEXT,                   -- 'career' | 'relationship' | 'health' | 'general'
    key_points TEXT NOT NULL,     -- AI ç”Ÿæˆçš„é‡é»æ‘˜è¦
    source_session_ids JSON,      -- ä¾†æºå°è©± session
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

---

## 7. é–‹ç™¼éšæ®µè¦åŠƒ (Development Roadmap)

### Phase 1: POC é©—è­‰ (1-2 é€±)
**ç›®æ¨™**: åœ¨ä¼ºæœå™¨ (172.237.6.53) ä¸Šè·‘é€šæœ€å°å¯è¡Œæ€§ç”¢å“ã€‚

| ä»»å‹™ | ç”¢å‡º | å„ªå…ˆç´š |
|------|------|--------|
| å»ºç«‹ `MemoryManager` | `src/utils/memory.py` | P0 |
| æ”¹é€ å°è©± API | `/api/chat/consult` æ”¯æ´ä¸Šä¸‹æ–‡ | P0 |
| ç°¡æ˜“å‰ç«¯ Demo | `webapp/chat_demo.html` | P0 |
| SSE é€²åº¦æ¨æ’­ | `/api/tasks/status` endpoint | P1 |

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (2-4 é€±)
| ä»»å‹™ | ç”¢å‡º | å„ªå…ˆç´š |
|------|------|--------|
| Tool Use æ•´åˆ | AI å¯èª¿ç”¨æ’ç›¤å·¥å…· | P0 |
| æ‘˜è¦èƒŒæ™¯ä»»å‹™ | è‡ªå‹•æ”¶æ–‚å°è©±ç‚ºæ‘˜è¦ | P0 |
| ä½¿ç”¨è€…ç•«åƒå»ºç«‹ | è‡ªå‹•æ¨™è¨˜ä½¿ç”¨è€…ç‰¹è³ª | P1 |
| Streaming è¼¸å‡º | é€å­—é¡¯ç¤º AI å›è¦† | P1 |

### Phase 3: é«”é©—å„ªåŒ– (4-6 é€±)
| ä»»å‹™ | ç”¢å‡º | å„ªå…ˆç´š |
|------|------|--------|
| Chat-First UI é‡æ§‹ | å…¨æ–° React å°è©±ä»‹é¢ | P0 |
| Hybrid Widgets | å°è©±ä¸­åµŒå…¥å‘½ç›¤å¡ç‰‡ | P1 |
| èªéŸ³æ¨¡å¼æ•´åˆ | OpenAI Realtime API | P2 |
| å¤šè£ç½®åŒæ­¥ | å°è©±æ­·å²é›²ç«¯åŒæ­¥ | P2 |

### 7.1 å¯¦ä½œå®Œæˆç‹€æ…‹ï¼ˆ2026-02-06ï¼‰
**çµè«–**ï¼šPhase 1â€“3 å…¨æ•¸å®Œæˆï¼Œä¸¦å·²å®Œæˆå›æ­¸æ¸¬è©¦ã€‚

**é—œéµå¯¦ä½œå°æ‡‰**
- ä¸‰å±¤è¨˜æ†¶èˆ‡æ‘˜è¦ï¼š
    - è¨˜æ†¶ç®¡ç†ï¼š [src/utils/memory.py](src/utils/memory.py)
    - è‡ªå‹•æ‘˜è¦ï¼š [src/utils/conversation_summarizer.py](src/utils/conversation_summarizer.py)
    - è³‡æ–™è¡¨ï¼š [src/utils/database.py](src/utils/database.py)
- Agent äººè¨­èˆ‡ç­–ç•¥ï¼š
    - ç³»çµ±æç¤ºèˆ‡ç‹€æ…‹æ©Ÿï¼š [src/prompts/agent_persona.py](src/prompts/agent_persona.py)
- Tool Use èˆ‡æœå°‹ï¼š
    - å·¥å…·å®šç¾©èˆ‡åŸ·è¡Œå™¨ï¼š [src/utils/tools.py](src/utils/tools.py)
- é€²åº¦æ„ŸçŸ¥èˆ‡ SSEï¼š
    - ä¸²æµèˆ‡äº‹ä»¶ï¼š [src/api/server.py](src/api/server.py)
    - å‰ç«¯é€²åº¦å¡ç‰‡ï¼š [webapp/src/ChatContainer.jsx](webapp/src/ChatContainer.jsx)
- Chat-First UI èˆ‡ Widgetsï¼š
    - è¨Šæ¯æ¸²æŸ“èˆ‡å›é¥‹ï¼š [webapp/src/MessageRenderer.jsx](webapp/src/MessageRenderer.jsx)
    - å‘½ç›¤å¡ç‰‡ï¼š [webapp/src/widgets/ChartWidget.jsx](webapp/src/widgets/ChartWidget.jsx)

**æ–°å¢æ²»ç†èˆ‡ç›£æ§èƒ½åŠ›**
- å›é¥‹æ©Ÿåˆ¶ã€ç›£æ§æŒ‡æ¨™ã€è³‡æ–™åˆªé™¤èˆ‡ä¿ç•™æ”¿ç­–ã€å“è³ªè©•ä¼° APIï¼š [src/api/server.py](src/api/server.py)

**æ¸¬è©¦ç‹€æ…‹**
- å…¨æ¸¬è©¦é€šéï¼ˆå« Golden Setï¼‰ã€‚

---

## 8. æŠ€è¡“æ£§ç¸½è¦½ (Tech Stack Summary)

| å±¤ç´š | æŠ€è¡“ | å‚™è¨» |
|------|------|------|
| **å¾Œç«¯æ¡†æ¶** | Flask / FastAPI | ç¾æœ‰ Flaskï¼Œå¯æ¼¸é€²é·ç§» |
| **AI æ¨¡å‹** | Gemini 2.0 Flash / Pro | å°è©±ç”¨ Flashï¼Œå ±å‘Šç”¨ Pro |
| **èªéŸ³ AI** | OpenAI Realtime API | WebRTC å³æ™‚èªéŸ³ |
| **ä»»å‹™ä½‡åˆ—** | Celery + Redis | æˆ–è¼•é‡çš„ asyncio |
| **è³‡æ–™åº«** | SQLite â†’ PostgreSQL | åˆæœŸ SQLiteï¼Œæ“´å±•ç”¨ PG |
| **å‘é‡æª¢ç´¢** | (é ç•™) ChromaDB / Pinecone | RAG ç”¨ï¼ŒPhase 2+ |
| **å‰ç«¯** | React 19 + Vite | ç¾æœ‰æ¶æ§‹ |
| **éƒ¨ç½²** | Linode (172.237.6.53) | Ubuntu + Nginx + systemd |

---

## 9. é¢¨éšªèˆ‡æŒ‘æˆ° (Risks & Mitigations)

| é¢¨éšª | å½±éŸ¿ | ç·©è§£ç­–ç•¥ |
|------|------|----------|
| Context éé•·å°è‡´ Token çˆ†é‡ | æˆæœ¬å¢åŠ ã€å»¶é² | ä¸‰å±¤è¨˜æ†¶ + å®šæœŸæ‘˜è¦ |
| AI å¹»è¦º (Hallucination) | å‘½ç†è§£è®€éŒ¯èª¤ | Tool Use å¼·åˆ¶æŸ¥è©¢çœŸå¯¦æ•¸æ“š |
| ä½¿ç”¨è€…æœŸæœ›éé«˜ | é«”é©—è½å·® | æ˜ç¢º AI èƒ½åŠ›é‚Šç•Œï¼Œé©æ™‚å¼•å° |
| æ’ç›¤é‹ç®—è€—æ™‚ | ä½¿ç”¨è€…ç­‰å¾…ç„¦æ…® | é€²åº¦æ¨æ’­ + å°è©±å¡«å……æ™‚é–“ |

### 9.1 æŠ€è¡“å‚µæ§åˆ¶è­·æ¬„èˆ‡å·¥ç¨‹æ²»ç† (Tech Debt Guardrails)

æœ¬å°ˆæ¡ˆçš„æœ€å¤§é¢¨éšªä¸æ˜¯ã€Œåšä¸å‡ºåŠŸèƒ½ã€ï¼Œè€Œæ˜¯ã€ŒåŠŸèƒ½èƒ½åšä½†è¶Šåšè¶Šé›£æ”¹ã€ã€‚ä»¥ä¸‹è­·æ¬„ç›®æ¨™æ˜¯ï¼š**å…ˆå›ºå®šåˆç´„èˆ‡è³‡æ–™å–®ä¸€çœŸç›¸ (SSOT)ï¼Œå†å¢é‡æ“´å±•èƒ½åŠ›**ï¼Œé¿å…éæ—©å¼•å…¥éå¤šåŸºç¤è¨­æ–½ã€‚

#### 9.1.1 å–®ä¸€çœŸç›¸ä¾†æº (SSOT) åŸå‰‡
*   **ä½¿ç”¨è€…è³‡æ–™ SSOT**: `user_persona`ï¼ˆç”Ÿè¾°ã€åå¥½ã€äººæ ¼æ¨™ç±¤ï¼‰æ˜¯å”¯ä¸€æ¬Šå¨ä¾†æºï¼›ä»»ä½•å¿«å–ï¼ˆå‘½ç›¤ JSONã€å‰ç«¯ stateï¼‰éƒ½éœ€å¯é‡å»ºã€‚
*   **å‘½ç›¤è³‡æ–™ SSOT**: åŸå§‹è¼¸å…¥ï¼ˆç”Ÿè¾°èˆ‡æ™‚å€ï¼‰+ å¯è¿½æº¯çš„è¨ˆç®—ç‰ˆæœ¬ï¼ˆcalculator ç‰ˆæœ¬/åƒæ•¸ï¼‰å¿…é ˆå¯å›æ”¾ï¼›å‘½ç›¤å¿«å–ä¸å¾—æˆç‚ºå”¯ä¸€ä¾†æºã€‚
*   **å°è©±äº‹ä»¶ SSOT**: `conversation_memory` çš„ `role='system_event'` ä½œç‚ºç³»çµ±äº‹ä»¶æ³¨å…¥çš„å”¯ä¸€å­˜æª”ï¼›å‰ç«¯åªæ¸²æŸ“ã€ä¸å¯ã€Œè‡ªç”¢ã€äº‹ä»¶ã€‚

#### 9.1.2 åˆç´„å„ªå…ˆï¼šAPI / Event / Tool Schema ç‰ˆæœ¬åŒ–
*   **API Schema**: å°å¤–ç«¯é»ï¼ˆå°¤å…¶ `/api/chat/consult`ï¼‰è«‹æ±‚/å›æ‡‰å»ºç«‹å›ºå®š JSON Schemaï¼ˆæˆ–ä»¥ Pydantic æ¨¡å‹æè¿°ï¼‰ï¼Œä¸¦åŠ ä¸Š `schema_version`ã€‚
*   **System Event Schema**: äº‹ä»¶ä¸€å¾‹æ¡ `type` + `payload` + `created_at`ï¼Œä¸¦æ”¯æ´ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼š`task.progress.v1`ã€`chart.ready.v1`ï¼‰ã€‚
*   **Tool Schema**: Function calling å·¥å…·å®šç¾©ï¼ˆname/args/returnï¼‰è¦è¦–ç‚ºåˆç´„ï¼›ä»»ä½•è®Šæ›´éƒ½å¿…é ˆå‘å¾Œç›¸å®¹æˆ–å‡ç‰ˆã€‚

#### 9.1.3 Prompt èˆ‡ç­–ç•¥æ²»ç†ï¼ˆå¯å›æ»¾ã€å¯æ¯”è¼ƒï¼‰
*   **Prompt Registry**: å°‡ system prompt / policy / tool instructions ä»¥æª”æ¡ˆåŒ–ç®¡ç†ï¼ˆç‰ˆæœ¬è™Ÿã€è®Šæ›´ç´€éŒ„ã€é©ç”¨æ¨¡å‹ï¼‰ï¼Œé¿å…æ•£è½åœ¨ç¨‹å¼å„è™•ã€‚
*   **å®‰å…¨èˆ‡é¢¨æ ¼åˆ†é›¢**: å®‰å…¨æ”¿ç­–ï¼ˆå€«ç†é‚Šç•Œï¼‰èˆ‡äººæ ¼/èªæ°£æ¨¡æ¿åˆ†é›¢ï¼Œé¿å…ã€Œæ”¹èªæ°£ã€ä¸å°å¿ƒç ´å£å®‰å…¨è¡Œç‚ºã€‚
*   **å¯å›æ»¾**: æ¯æ¬¡ä¸Šç·šåƒ…å…è¨±åˆ‡æ›å°‘é‡ prompt/ç­–ç•¥ï¼›å‡ºå•é¡Œèƒ½å¿«é€Ÿå›é€€ä¸Šä¸€ç‰ˆã€‚

#### 9.1.4 è³‡æ–™ç”Ÿå‘½é€±æœŸèˆ‡éš±ç§ï¼ˆå¾ä¸€é–‹å§‹å°±åšï¼‰
*   **è³‡æ–™æœ€å°åŒ–**: é è¨­ä¸ä¿å­˜ä¸å¿…è¦çš„è‡ªç”±æ–‡å­—ï¼ˆä¾‹å¦‚èº«åˆ†è­‰/ä½å€ç­‰ï¼‰ï¼Œä¸¦åœ¨å„²å­˜å‰åšç°¡å–® PII åµæ¸¬èˆ‡é®ç½©ï¼ˆå¯å…ˆå¾é—œéµè¦å‰‡é–‹å§‹ï¼‰ã€‚
*   **ä¿ç•™æœŸé™**: å°è©±å…¨æ–‡ï¼ˆLayer 1ï¼‰è¨­å®šä¿ç•™æœŸé™èˆ‡å°å­˜ç­–ç•¥ï¼›æ‘˜è¦ï¼ˆLayer 2ï¼‰å¯é•·æœŸä¿ç•™ä½†éœ€å¯åˆªé™¤ã€‚
*   **åˆªé™¤èƒ½åŠ›**: æä¾›ã€Œåˆªé™¤æˆ‘çš„è³‡æ–™ã€å°æ‡‰çš„å¾Œç«¯æµç¨‹ï¼ˆå¯å…ˆåšç®¡ç†ç”¨æŒ‡ä»¤/ç«¯é»ï¼‰ã€‚

#### 9.1.5 æœ€å°è©•ä¼°é›†èˆ‡å›æ­¸æ¸¬è©¦ï¼ˆå…ˆå°å†å¤§ï¼‰
*   **Golden Set**: å»ºç«‹ 20-50 æ¢ä»£è¡¨æ€§å°è©±è…³æœ¬ï¼ˆä¸åŒæ„åœ–/æƒ…ç·’/ç³»çµ±çµ„åˆï¼‰ï¼Œåšç‚ºæ¯æ¬¡è®Šæ›´çš„æœ€å°å›æ­¸é›†ã€‚
*   **å¯é‡æ’­ (Replay)**: æ”¯æ´ç”¨å›ºå®šè¼¸å…¥é‡æ’­å°è©±æµç¨‹ï¼Œæª¢æŸ¥ï¼šå·¥å…·èª¿ç”¨æ˜¯å¦æ­£ç¢ºã€å¼•ç”¨æ˜¯å¦ä¸€è‡´ã€æ˜¯å¦é•åå®‰å…¨è¦å‰‡ã€‚
*   **æŒ‡æ¨™åŒ–**: è‡³å°‘è¨˜éŒ„ï¼šå·¥å…·æˆåŠŸç‡ã€å¹³å‡å»¶é²ã€æ‘˜è¦ç”¢ç”Ÿç‡ã€è¢«æ‹’ç­”æ¯”ä¾‹ï¼ˆå®‰å…¨è§¸ç™¼ï¼‰èˆ‡ç”¨æˆ¶å›é¥‹ã€‚

#### 9.1.6 åˆ†æœŸä¸ŠåŸºç¤è¨­æ–½ï¼ˆé¿å…éæ—©æ¶å¤§å·¥ç¨‹ï¼‰
*   **å…ˆ SQLite/æª”æ¡ˆã€å¾Œå‘é‡åº«**: Phase 1/2 å…ˆç”¨ SQLite å®Œæˆ episodic/semantic çš„æœ€å°æª¢ç´¢ï¼›ç­‰æŸ¥è©¢é‡èˆ‡å“è³ªéœ€æ±‚æ˜ç¢ºå†ä¸Šå‘é‡åº«ã€‚
*   **å…ˆ SSEã€å¾Œ WebSocket**: è‹¥åªéœ€è¦ã€Œä¼ºæœå™¨æ¨æ’­é€²åº¦ã€ï¼ŒSSE æˆæœ¬æœ€ä½ï¼›éœ€è¦é›™å‘äº’å‹•å†å‡ç´šã€‚
*   **å…ˆ Flask å¢é‡æ”¹é€ ã€å¾Œæ¡†æ¶é·ç§»**: è‹¥è¦ FastAPIï¼Œæ¡ Strangler Patternï¼ˆæ–°ç«¯é»ç”¨æ–°æ¡†æ¶ï¼ŒèˆŠç«¯é»ä¿ç•™ï¼‰è€Œéä¸€æ¬¡æ€§å¤§é·ç§»ã€‚

---

## 10. å€«ç†é‚Šç•Œèˆ‡å®‰å…¨æ©Ÿåˆ¶ (Ethics & Safety)

### 10.1 æ•æ„Ÿè­°é¡Œè™•ç†æº–å‰‡

| è­°é¡Œé¡å‹ | AI è¡Œç‚ºæº–å‰‡ | ç¯„ä¾‹å›æ‡‰ |
|----------|-------------|----------|
| **å¥åº·/ç–¾ç—…** | çµ•ä¸è¨ºæ–·æˆ–é æ¸¬ç–¾ç—…ï¼Œå»ºè­°å°±é†« | ã€Œå‘½ç›¤å¯ä»¥çœ‹æ•´é«”å¥åº·è¶¨å‹¢ï¼Œä½†å…·é«”ç—‡ç‹€è«‹å‹™å¿…è«®è©¢é†«ç”Ÿã€‚ã€ |
| **ç”Ÿæ­»é æ¸¬** | æ‹’çµ•å›ç­”å£½å‘½ç›¸é—œå•é¡Œ | ã€Œé€™é¡å•é¡Œä¸åœ¨æˆ‘èƒ½å›ç­”çš„ç¯„åœï¼Œå‘½ç†æ›´é©åˆçœ‹äººç”Ÿæ–¹å‘ã€‚ã€ |
| **æŠ•è³‡ç†è²¡** | ä¸çµ¦å…·é«”æŠ•è³‡å»ºè­° | ã€Œè²¡é‹è¶¨å‹¢å¯ä»¥åƒè€ƒï¼Œä½†æŠ•è³‡æ±ºç­–è«‹è«®è©¢å°ˆæ¥­ç†è²¡é¡§å•ã€‚ã€ |
| **æ³•å¾‹ç³¾ç´›** | ä¸é æ¸¬è¨´è¨Ÿçµæœ | ã€Œæ³•å¾‹å•é¡Œå»ºè­°è«®è©¢å¾‹å¸«ï¼Œå‘½ç›¤åªèƒ½çœ‹å¤§æ–¹å‘çš„é‹å‹¢èµ·ä¼ã€‚ã€ |
| **è‡ªæ®º/è‡ªå‚·** | ç«‹å³è½‰ä»‹å°ˆæ¥­è³‡æº | ã€Œæˆ‘å¾ˆæ“”å¿ƒä½ ç¾åœ¨çš„ç‹€æ…‹ã€‚é€™ç¨®æ™‚å€™å°ˆæ¥­çš„å¿ƒç†è«®è©¢æœƒæ›´æœ‰å¹«åŠ©ï¼Œè¦ä¸è¦æˆ‘æä¾›ä¸€äº›è³‡æºï¼Ÿã€ |

### 10.2 é¿å…è¿·ä¿¡èˆ‡ä¾è³´

```
[å®šæœŸæé†’ - ç³»çµ±è‡ªå‹•æ’å…¥]
ã€Œè¨˜å¾—ï¼Œå‘½ç†æ˜¯ä¸€ç¨®åƒè€ƒå·¥å…·ï¼Œå¹«åŠ©æˆ‘å€‘äº†è§£è‡ªå·±å’Œè¶¨å‹¢ï¼Œä½†äººç”Ÿçš„é¸æ“‡æ¬Šæ°¸é åœ¨ä½ æ‰‹ä¸Šã€‚ã€

[ç•¶ç”¨æˆ¶éåº¦ä¾è³´æ™‚]
åµæ¸¬ä¿¡è™Ÿï¼šæ¯æ—¥è«®è©¢ã€æ±ºç­–å‰å¿…å•ã€ç„¦æ…®æ€§é‡è¤‡æå•
å›æ‡‰ç­–ç•¥ï¼šã€Œæˆ‘æ³¨æ„åˆ°ä½ æœ€è¿‘å•äº†å¾ˆå¤šé¡ä¼¼çš„å•é¡Œã€‚æœ‰æ™‚å€™ï¼Œçµ¦è‡ªå·±ä¸€é»ç©ºé–“æ¶ˆåŒ–ï¼Œ
          åè€Œèƒ½çœ‹å¾—æ›´æ¸…æ¥šã€‚è¦ä¸è¦æˆ‘å€‘ä¸‹é€±å†èŠï¼Ÿã€
```

### 10.3 è³‡æ–™éš±ç§ä¿è­·

| ä¿è­·æªæ–½ | å¯¦ä½œæ–¹å¼ |
|----------|----------|
| æœ€å°åŒ–æ”¶é›† | åªæ”¶é›†å‘½ç†åˆ†æå¿…è¦çš„è³‡è¨Š |
| åŠ å¯†å„²å­˜ | æ•æ„Ÿè³‡æ–™ï¼ˆç”Ÿè¾°ã€å°è©±ï¼‰åŠ å¯†å­˜æ”¾ |
| ç”¨æˆ¶æ§åˆ¶ | æä¾›ã€Œåˆªé™¤æˆ‘çš„è³‡æ–™ã€åŠŸèƒ½ |
| ä¸å¤–æ´© | çµ•ä¸å°‡ç”¨æˆ¶è³‡æ–™ç”¨æ–¼è¨“ç·´æˆ–åˆ†äº«ç¬¬ä¸‰æ–¹ |

---

## 11. å“è³ªä¿è­‰èˆ‡æŒçºŒæ”¹é€² (Quality Assurance & Improvement)

### 11.1 å›ç­”å“è³ªè©•ä¼°æ¡†æ¶

| ç¶­åº¦ | è©•ä¼°æ¨™æº– | é‡åŒ–æ–¹å¼ |
|------|----------|----------|
| **æº–ç¢ºæ€§** | å‘½ç›¤è§£è®€æ˜¯å¦æ­£ç¢ºå¼•ç”¨æ•¸æ“š | è‡ªå‹•æ¯”å° Tool èª¿ç”¨çµæœ |
| **ç›¸é—œæ€§** | å›ç­”æ˜¯å¦åˆ‡é¡Œ | ç”¨æˆ¶è¿½å•ç‡ï¼ˆè¶Šä½è¶Šå¥½ï¼‰ |
| **åŒç†å¿ƒ** | æƒ…ç·’å›æ‡‰æ˜¯å¦å¾—ç•¶ | æƒ…ç·’åµæ¸¬ + ç”¨æˆ¶å›é¥‹ |
| **æ·±åº¦** | æ˜¯å¦æä¾›æœ‰åƒ¹å€¼çš„æ´å¯Ÿ | å°è©±é•·åº¦ã€ç”¨æˆ¶åƒèˆ‡åº¦ |
| **å®‰å…¨æ€§** | æ˜¯å¦éµå®ˆå€«ç†é‚Šç•Œ | è‡ªå‹•å¯©æ ¸ + äººå·¥æŠ½æª¢ |

### 11.2 ç”¨æˆ¶å›é¥‹æ©Ÿåˆ¶

```
[å°è©±çµæŸæ™‚]
ğŸŒŸ é€™æ¬¡å°è©±å°ä½ æœ‰å¹«åŠ©å—ï¼Ÿ
   [å¾ˆæœ‰å¹«åŠ©] [é‚„å¯ä»¥] [æ²’ä»€éº¼å¹«åŠ©]
   
[å¯é¸è¿½å•]
ğŸ’¬ æœ‰ä»€éº¼å¯ä»¥æ”¹é€²çš„åœ°æ–¹å—ï¼Ÿï¼ˆé¸å¡«ï¼‰
   [ æ–‡å­—è¼¸å…¥æ¡† ]
```

### 11.3 æŒçºŒå­¸ç¿’å¾ªç’°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ¶å°è©±   â”‚ â”€â”€â–¶ â”‚  å“è³ªè©•ä¼°   â”‚ â”€â”€â–¶ â”‚  æ¨™è¨˜å•é¡Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prompt å„ªåŒ– â”‚ â—€â”€â”€ â”‚  äººå·¥å¯©æ ¸   â”‚ â—€â”€â”€ â”‚  å•é¡Œåˆ†é¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  A/B æ¸¬è©¦   â”‚ â”€â”€â–¶ é©—è­‰æ”¹é€²æ•ˆæœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.4 ç›£æ§èˆ‡å‘Šè­¦

| ç›£æ§æŒ‡æ¨™ | å‘Šè­¦é–¾å€¼ | è™•ç†æ–¹å¼ |
|----------|----------|----------|
| å¹³å‡å›æ‡‰æ™‚é–“ | > 10 ç§’ | æª¢æŸ¥ API æˆ–æ¨¡å‹ç‹€æ…‹ |
| ç”¨æˆ¶æ»¿æ„åº¦ | < 70% | è§¸ç™¼ Prompt å¯©æ ¸ |
| å®‰å…¨é•è¦æ¬¡æ•¸ | > 0 | ç«‹å³äººå·¥ä»‹å…¥ |
| å°è©±ä¸­æ–·ç‡ | > 30% | åˆ†æä¸­æ–·åŸå›  |
| Tool èª¿ç”¨å¤±æ•—ç‡ | > 5% | æª¢æŸ¥å¾Œç«¯æœå‹™ |

---

## 12. å·®ç•°åŒ–ç«¶çˆ­å„ªå‹¢ (Competitive Differentiation)

### 12.1 vs å‚³çµ±å‘½ç†è»Ÿé«”
| å‚³çµ±è»Ÿé«” | Aetheria |
|----------|----------|
| å¡«è¡¨ â†’ ç­‰å ±å‘Š â†’ è‡ªå·±è®€ | å°è©±å³æœå‹™ï¼Œé‚ŠèŠé‚Šè§£ |
| å†·å†°å†°çš„æ•¸æ“šç¾…åˆ— | æœ‰æº«åº¦çš„æ•˜äº‹è§£è®€ |
| ä¸€æ¬¡æ€§äº¤æ˜“ | é•·æœŸé™ªä¼´ï¼Œè¨˜å¾—ä½ çš„æ•…äº‹ |

### 12.2 vs é€šç”¨ AI èŠå¤©æ©Ÿå™¨äºº
| é€šç”¨ ChatGPT | Aetheria |
|--------------|----------|
| æ³›æ³›çš„å‘½ç†çŸ¥è­˜ | çœŸå¯¦æ’ç›¤ + ç²¾æº–æ•¸æ“š |
| ä¸è¨˜å¾—ä½ æ˜¯èª° | é•·æœŸè¨˜æ†¶ + å€‹äººåŒ– |
| å¯èƒ½èƒ¡èªªå…«é“ | Tool Use ç¢ºä¿æ•¸æ“šä¾†æº |

### 12.3 vs çœŸäººå‘½ç†å¸«
| çœŸäººå‘½ç†å¸« | Aetheria |
|------------|----------|
| è¦é ç´„ã€è¦ç­‰å¾… | 24/7 éš¨æ™‚å¯èŠ |
| å“è³ªåƒå·®ä¸é½Š | ç©©å®šä¸€è‡´çš„å“è³ª |
| å–®æ¬¡è«®è©¢è²»ç”¨é«˜ | è¨‚é–±åˆ¶ï¼ŒCP å€¼é«˜ |
| å¯èƒ½å¿˜è¨˜ä½ ä¸Šæ¬¡èªªçš„ | å®Œæ•´è¨˜æ†¶ä½ çš„æ­·ç¨‹ |

---

## é™„éŒ„ A: ç¾æœ‰ç³»çµ±è³‡ç”¢ç›¤é»

å¯ç›´æ¥æ²¿ç”¨çš„æ¨¡çµ„ï¼š
- `src/calculators/`: å…­å¤§å‘½ç†è¨ˆç®—å¼•æ“ âœ…
- `src/prompts/`: Gemini æç¤ºè©æ¨¡æ¿ (éœ€èª¿æ•´ç‚º Agent é¢¨æ ¼)
- `src/utils/gemini_client.py`: AI å‘¼å«å°è£ âœ…
- `src/utils/database.py`: SQLite åŸºç¤æ“ä½œ âœ…

éœ€é‡æ§‹æˆ–æ–°å¢ï¼š
- `src/utils/memory.py`: **æ–°å¢** - è¨˜æ†¶ç®¡ç†
- `src/api/server.py`: **é‡æ§‹** - æ”¯æ´ Agent æ¨¡å¼
- `webapp/`: **é‡æ§‹** - Chat-First UI

---

## é™„éŒ„ B: åƒè€ƒè³‡æº

- [Gemini Function Calling](https://ai.google.dev/docs/function_calling)
- [OpenAI Realtime API](https://platform.openai.com/docs/guides/realtime)
- [LangChain Memory](https://python.langchain.com/docs/modules/memory/)
- [Anthropic Claude's Memory Pattern](https://docs.anthropic.com/)

---

**æ–‡ä»¶ç¶­è­·è€…**: Aetheria Dev Team  
**æœ€å¾Œæ›´æ–°**: 2026-02-04
