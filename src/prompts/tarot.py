"""
å¡”ç¾…ç‰Œ Prompt æ¨¡æ¿ (Tarot Prompts)
Aetheria Core v1.5.0

åŠŸèƒ½ï¼š
- å¡”ç¾…ç‰Œè§£è®€ Prompt ç”Ÿæˆ
- ä¸åŒç‰Œé™£çš„å°ˆå±¬è§£è®€æ¨¡æ¿
- æ”¯æ´å¤šç¨®å•é¡Œæƒ…å¢ƒï¼ˆæ„›æƒ…ã€äº‹æ¥­ã€è²¡å‹™ã€å¥åº·ã€é€šç”¨ï¼‰
"""

from typing import Optional, Dict, List
from src.calculators.tarot import TarotCalculator, TarotReading


# ==================== ç³»çµ±æç¤ºè© ====================

TAROT_SYSTEM_PROMPT = """ä½ å¥½ï¼Œæˆ‘æ˜¯ Aetheriaã€‚æˆ‘è‡´åŠ›æ–¼é€éå¡”ç¾…ç‰Œçš„è±¡å¾µèªè¨€ï¼Œç‚ºä½ çš„å¿ƒéˆè¿·éœ§é–‹å•Ÿä¸€æ‰‡æ˜äº®çš„çª—ã€‚

ä½ æ˜¯ä¸€ä½å…·å‚™æ·±åšæ¦®æ ¼å¿ƒç†å­¸èƒŒæ™¯èˆ‡ç¥ç¥•å­¸åº•è˜Šçš„è³‡æ·±å¡”ç¾…è§£è®€å¸«ã€‚ä½ ä½¿ç”¨çš„ Rider-Waite-Smith ç³»çµ±ä¸åªæ˜¯å åœå·¥å…·ï¼Œæ›´æ˜¯æ¢ç´¢æ½›æ„è­˜èˆ‡é›†é«”å¿ƒéˆçš„åª’ä»‹ã€‚

ã€æ ¼å¼è¦æ±‚ã€‘
1. ä½¿ç”¨ Markdown æ ¼å¼è¼¸å‡º
2. æ¨™é¡Œå±¤ç´šï¼šä½¿ç”¨ ## å’Œ ###
3. é‡é»ä½¿ç”¨ **ç²—é«”**
4. æ¢åˆ—é …ç›®ä½¿ç”¨ * æˆ– 1. 2. 3.
5. é‡è¦åˆ†éš”ä½¿ç”¨ ---

ã€æ ¸å¿ƒåŸå‰‡ï¼šæœ‰æ‰€æœ¬ã€‘
1. **è±¡å¾µç¬¦è™Ÿå­¸**ï¼šæ¯ä¸€å¼µç‰Œçš„è§£è®€éƒ½å¿…é ˆå¼•ç”¨ç‰Œé¢ä¸Šçš„å…·é«”åœ–æ¡ˆï¼ˆå¦‚ï¼šæ„šè€…çš„æ‡¸å´–ã€é­”è¡“å¸«çš„ç„¡é™ç¬¦è™Ÿã€æˆ€äººçš„å¤©ä½¿ç­‰ï¼‰ä¸¦è§£é‡‹å…¶å«ç¾©ã€‚
2. **å…ƒç´ èˆ‡æ˜Ÿè±¡äº’å‹•**ï¼šçµåˆç‰Œçµ„å°æ‡‰çš„å…ƒç´ ï¼ˆç«åœŸé¢¨æ°´ï¼‰èˆ‡å°æ‡‰çš„å æ˜Ÿç¬¦è™Ÿé€²è¡Œæ·±åº¦è§£æã€‚
3. **å¿ƒç†é¢å‘**ï¼šä»¥å•Ÿç™¼å¼ã€å¿ƒç†æˆé•·çš„è§’åº¦å‡ºç™¼ï¼Œè€Œéå–®ç´”çš„å¥½å£æ–·èªã€‚

ã€è§£è®€æ¶æ§‹ã€‘
## ä¸€ã€ ç‰Œé™£èƒ½é‡å ´ï¼šæ•´é«”æ°›åœçš„å…±æŒ¯
## äºŒã€ ç‰Œç¾©æ·±åº¦è§£æ§‹ï¼šåˆ†é …è§£è®€ï¼ˆåŒ…å«è±¡å¾µé»èˆ‡é€£çµï¼‰
## ä¸‰ã€ å¿ƒç†æ©Ÿåˆ¶æ´å¯Ÿï¼šå…§åœ¨é©…åŠ›èˆ‡é™°å½±é¢
## å››ã€ Aetheria çš„æˆ°ç•¥å¼•å°èˆ‡è¡Œå‹•å»ºè­°

è«‹ç”¨ç¹é«”ä¸­æ–‡ï¼ˆå°ç£ç¿’æ…£ç”¨èªï¼‰å›è¦†ï¼Œèªæ°£æº«æš–ã€å°ˆæ¥­ä¸”å……æ»¿æ™ºæ…§ã€‚"""


# ==================== ç‰Œé™£è§£è®€æ¨¡æ¿ ====================

def get_single_card_prompt(reading: TarotReading, context: str = "general") -> str:
    """å–®å¼µç‰Œè§£è®€ Prompt"""
    calculator = TarotCalculator()
    card = reading.cards[0]
    card_meaning = calculator.get_card_meaning(card.id, card.is_reversed, context)
    orientation = "é€†ä½" if card.is_reversed else "æ­£ä½"
    
    context_labels = {
        "general": "æ•´é«”æŒ‡å¼•",
        "love": "æ„Ÿæƒ…æ„›æƒ…",
        "career": "äº‹æ¥­å·¥ä½œ",
        "finance": "è²¡å‹™é‡‘éŒ¢",
        "health": "å¥åº·èº«å¿ƒ"
    }
    context_label = context_labels.get(context, "æ•´é«”æŒ‡å¼•")
    
    prompt = f"""è«‹ç‚ºä»¥ä¸‹å¡”ç¾…ç‰Œè§£è®€æä¾›æ·±å…¥çš„è©®é‡‹ã€‚

ã€å•é¡Œã€‘{reading.question or "ä»Šæ—¥æŒ‡å¼•"}
ã€å•é¡Œé¡å‹ã€‘{context_label}

ã€æŠ½åˆ°çš„ç‰Œã€‘{card.name}ï¼ˆ{orientation}ï¼‰
- è‹±æ–‡åï¼š{card.name_en}
- ç‰Œçµ„ï¼š{"å¤§é˜¿çˆ¾å…‹é‚£" if card_meaning.get("arcana") == "major" else f"å°é˜¿çˆ¾å…‹é‚£ - {card_meaning.get('suit', '')}"}
- å…ƒç´ ï¼š{card_meaning.get("element", "ç„¡")}
- é—œéµè©ï¼š{', '.join(card_meaning.get('keywords', []))}
- å‚³çµ±ç‰Œç¾©ï¼š{card_meaning.get('meaning', '')}
- è±¡å¾µæ„ç¾©ï¼š{card_meaning.get('symbolism', 'ç„¡')}

è«‹æä¾›ï¼š

## ğŸ”® ç‰Œå¡è¨Šæ¯
ï¼ˆ200-300å­—çš„æ ¸å¿ƒè§£è®€ï¼Œèªªæ˜é€™å¼µç‰Œå°å•åœè€…ç•¶å‰è™•å¢ƒçš„æ„ç¾©ï¼‰

## ğŸ’¡ æ·±åº¦æ´å¯Ÿ
- é€™å¼µç‰Œæƒ³å‘Šè¨´ä½ ä»€éº¼ï¼Ÿ
- å®ƒåæ˜ äº†ä½ å…§å¿ƒçš„ä»€éº¼ç‹€æ…‹ï¼Ÿ
- {"é€†ä½ä»£è¡¨ä»€éº¼ç‰¹æ®Šæé†’ï¼Ÿ" if card.is_reversed else "æ­£ä½å¸¶ä¾†ä»€éº¼æ­£é¢èƒ½é‡ï¼Ÿ"}

## ğŸ¯ è¡Œå‹•å»ºè­°
ï¼ˆ3-5 å€‹å…·é«”å¯åŸ·è¡Œçš„å»ºè­°ï¼‰

## âœ¨ ä»Šæ—¥ç®´è¨€
ï¼ˆä¸€å¥ç°¡çŸ­æœ‰åŠ›çš„è©±èªä½œç‚ºä»Šæ—¥åº§å³éŠ˜ï¼‰

---
**è¨˜å¾—**ï¼šå¡”ç¾…ç‰Œæ˜¯å¿ƒéˆçš„é¡å­ï¼Œåæ˜ çš„æ˜¯ç•¶ä¸‹èƒ½é‡ã€‚ä½ æ“æœ‰æ”¹è®Šå‘½é‹çš„åŠ›é‡ã€‚
"""
    return prompt


def get_three_card_prompt(reading: TarotReading, context: str = "general") -> str:
    """ä¸‰å¼µç‰Œè§£è®€ Prompt"""
    calculator = TarotCalculator()
    
    context_labels = {
        "general": "æ•´é«”æŒ‡å¼•",
        "love": "æ„Ÿæƒ…æ„›æƒ…",
        "career": "äº‹æ¥­å·¥ä½œ",
        "finance": "è²¡å‹™é‡‘éŒ¢",
        "health": "å¥åº·èº«å¿ƒ"
    }
    context_label = context_labels.get(context, "æ•´é«”æŒ‡å¼•")
    
    cards_info = []
    for card in reading.cards:
        card_meaning = calculator.get_card_meaning(card.id, card.is_reversed, context)
        orientation = "é€†ä½" if card.is_reversed else "æ­£ä½"
        cards_info.append(f"""
### {card.position}ï¼š{card.name}ï¼ˆ{orientation}ï¼‰
- è‹±æ–‡åï¼š{card.name_en}
- é—œéµè©ï¼š{', '.join(card_meaning.get('keywords', []))}
- ç‰Œç¾©ï¼š{card_meaning.get('meaning', '')}
- å…ƒç´ ï¼š{card_meaning.get('element', 'ç„¡')}""")
    
    prompt = f"""è«‹ç‚ºä»¥ä¸‹ä¸‰å¼µç‰Œå¡”ç¾…ç‰Œé™£æä¾›å®Œæ•´è§£è®€ã€‚

ã€å•é¡Œã€‘{reading.question or "è«‹ç‚ºæˆ‘è§£è®€ç•¶å‰ç‹€æ³"}
ã€å•é¡Œé¡å‹ã€‘{context_label}
ã€ç‰Œé™£ã€‘ä¸‰å¼µç‰Œï¼ˆéå» - ç¾åœ¨ - æœªä¾†ï¼‰

{''.join(cards_info)}

---

è«‹æä¾›ä»¥ä¸‹è§£è®€ï¼š

## ğŸ“– æ•´é«”æ•…äº‹
ï¼ˆ400-500å­—ï¼Œå°‡ä¸‰å¼µç‰Œä¸²é€£æˆä¸€å€‹å®Œæ•´çš„æ•…äº‹æ•˜è¿°ã€‚èªªæ˜éå»å¦‚ä½•å½±éŸ¿ç¾åœ¨ï¼Œç¾åœ¨åˆå°‡å¦‚ä½•å°å‘æœªä¾†ã€‚ï¼‰

## ğŸ” é€å¼µè§£è®€

### 1ï¸âƒ£ éå»çš„å½±éŸ¿
ï¼ˆé€™å¼µç‰Œæ­ç¤ºäº†ä»€éº¼éå»çš„ç¶“æ­·æˆ–æ¨¡å¼ï¼Ÿå®ƒå¦‚ä½•å½±éŸ¿åˆ°ç¾åœ¨ï¼Ÿï¼‰

### 2ï¸âƒ£ ç•¶å‰ç‹€æ…‹
ï¼ˆç¾åœ¨çš„æ ¸å¿ƒè­°é¡Œæ˜¯ä»€éº¼ï¼Ÿå•åœè€…æ­£é¢è‡¨ä»€éº¼æŒ‘æˆ°æˆ–æ©Ÿæœƒï¼Ÿï¼‰

### 3ï¸âƒ£ æœªä¾†è¶¨å‹¢
ï¼ˆå¦‚æœç¶­æŒç•¶å‰æ–¹å‘ï¼Œæœªä¾†å¯èƒ½å¦‚ä½•ç™¼å±•ï¼Ÿé€™æ˜¯è­¦å‘Šé‚„æ˜¯é¼“å‹µï¼Ÿï¼‰

## ğŸ’ æ ¸å¿ƒæ´å¯Ÿ
ï¼ˆ3-5 é»å¾é€™çµ„ç‰Œä¸­çœ‹åˆ°çš„é—œéµè¨Šæ¯ï¼‰

## ğŸ¯ è¡Œå‹•å»ºè­°
ï¼ˆæ ¹æ“šç‰Œé™£æä¾› 3-5 å€‹å…·é«”å¯åŸ·è¡Œçš„å»ºè­°ï¼‰

## ğŸ”‘ é—œéµå•å¥
ï¼ˆä¸€å€‹è®“å•åœè€…æ·±æ€çš„å•é¡Œï¼Œå¹«åŠ©ä»–å€‘è‡ªæˆ‘åçœï¼‰

---
**è¨˜å¾—**ï¼šæœªä¾†ä¸æ˜¯å›ºå®šçš„ã€‚é€™äº›ç‰Œé¡¯ç¤ºçš„æ˜¯ã€Œç•¶å‰è»Œé“ã€ä¸Šçš„å¯èƒ½ç™¼å±•ï¼Œä½ éš¨æ™‚å¯ä»¥é€éè¡Œå‹•æ”¹è®Šæ–¹å‘ã€‚
"""
    return prompt


def get_celtic_cross_prompt(reading: TarotReading, context: str = "general") -> str:
    """è³½çˆ¾ç‰¹åå­—è§£è®€ Prompt"""
    calculator = TarotCalculator()
    
    context_labels = {
        "general": "æ•´é«”æŒ‡å¼•",
        "love": "æ„Ÿæƒ…æ„›æƒ…",
        "career": "äº‹æ¥­å·¥ä½œ",
        "finance": "è²¡å‹™é‡‘éŒ¢",
        "health": "å¥åº·èº«å¿ƒ"
    }
    context_label = context_labels.get(context, "æ•´é«”æŒ‡å¼•")
    
    cards_info = []
    for i, card in enumerate(reading.cards):
        card_meaning = calculator.get_card_meaning(card.id, card.is_reversed, context)
        orientation = "é€†ä½" if card.is_reversed else "æ­£ä½"
        cards_info.append(f"""
### {i+1}. {card.position}
**{card.name}ï¼ˆ{orientation}ï¼‰**
- é—œéµè©ï¼š{', '.join(card_meaning.get('keywords', []))}
- ç‰Œç¾©ï¼š{card_meaning.get('meaning', '')}""")
    
    prompt = f"""è«‹ç‚ºä»¥ä¸‹è³½çˆ¾ç‰¹åå­—ç‰Œé™£æä¾›å®Œæ•´æ·±å…¥çš„è§£è®€ã€‚

ã€å•é¡Œã€‘{reading.question or "è«‹ç‚ºæˆ‘è§£è®€ç•¶å‰äººç”Ÿç‹€æ³"}
ã€å•é¡Œé¡å‹ã€‘{context_label}
ã€ç‰Œé™£ã€‘è³½çˆ¾ç‰¹åå­—ï¼ˆCeltic Crossï¼‰- å¡”ç¾…ç‰Œæœ€ç¶“å…¸çš„åå¼µç‰Œé™£

{''.join(cards_info)}

---

è«‹æä¾›ä»¥ä¸‹å®Œæ•´è§£è®€ï¼ˆé€™æ˜¯æ·±åº¦åˆ†æï¼Œè«‹æä¾›è©³ç´°å…§å®¹ï¼‰ï¼š

## ğŸŒŸ æ•´é«”æ¦‚è¦½
ï¼ˆ300-400å­—ï¼Œæ¦‚è¿°æ•´å€‹ç‰Œé™£é€éœ²çš„æ ¸å¿ƒè¨Šæ¯èˆ‡èƒ½é‡èµ°å‘ï¼‰

## ğŸ” ç‰Œé™£æ·±åº¦è§£è®€

### æ ¸å¿ƒå€åŸŸï¼ˆç‰Œ 1-2ï¼‰
- ç¾æ³æ ¸å¿ƒï¼šä½ ç›®å‰é¢è‡¨çš„çœŸæ­£è­°é¡Œæ˜¯ä»€éº¼ï¼Ÿ
- æ©«å‘å½±éŸ¿ï¼šä»€éº¼åŠ›é‡æ­£åœ¨å¹«åŠ©æˆ–é˜»ç¤™ä½ ï¼Ÿ

### æ™‚é–“è»¸ï¼ˆç‰Œ 3-6ï¼‰
- æ„è­˜/æ½›æ„è­˜ï¼šä½ çŸ¥é“èˆ‡ä¸çŸ¥é“çš„å„æ˜¯ä»€éº¼ï¼Ÿ
- éå»/æœªä¾†ï¼šäº‹æƒ…å¦‚ä½•æ¼”è®Šï¼Ÿ

### è‡ªæˆ‘èˆ‡ç’°å¢ƒï¼ˆç‰Œ 7-8ï¼‰
- ä½ å¦‚ä½•çœ‹å¾…è‡ªå·±åœ¨é€™ä»¶äº‹ä¸­çš„è§’è‰²ï¼Ÿ
- å‘¨é­çš„äººèˆ‡ç’°å¢ƒå¦‚ä½•å½±éŸ¿ä½ ï¼Ÿ

### å¸Œæœ›/ææ‡¼èˆ‡çµæœï¼ˆç‰Œ 9-10ï¼‰
- ä½ æœ€æ·±çš„æœŸæœ›èˆ‡ææ‡¼æ˜¯ä»€éº¼ï¼Ÿ
- å¦‚æœç¶­æŒç•¶å‰æ–¹å‘ï¼Œæœ€çµ‚çµæœæœƒæ˜¯ä»€éº¼ï¼Ÿ

## ğŸ’ é—œéµæ´å¯Ÿ
ï¼ˆ5-7 é»å¾æ•´é«”ç‰Œé™£ä¸­ç²å¾—çš„æ ¸å¿ƒè¨Šæ¯ï¼‰

## âš ï¸ éœ€è¦æ³¨æ„çš„è­¦è¨Š
ï¼ˆç‰Œé™£ä¸­æœ‰å“ªäº›è­¦å‘Šæˆ–éœ€è¦ç‰¹åˆ¥ç•™æ„çš„åœ°æ–¹ï¼Ÿï¼‰

## ğŸŒˆ æ­£é¢èƒ½é‡
ï¼ˆç‰Œé™£ä¸­æœ‰å“ªäº›æ”¯æŒèˆ‡ç¥ç¦çš„èƒ½é‡ï¼Ÿï¼‰

## ğŸ¯ è¡Œå‹•è¨ˆåŠƒ
ï¼ˆæ ¹æ“šç‰Œé™£æä¾›ä¸€å€‹å…·é«”çš„è¡Œå‹•è¨ˆåŠƒï¼ŒåŒ…å« 5-7 å€‹æ­¥é©Ÿï¼‰

## ğŸ’¬ çµ¦ä½ çš„è©±
ï¼ˆ100-150å­—ï¼Œä»¥æº«æš–ä¸”è³¦æ¬Šçš„èªæ°£ï¼Œçµ¦å•åœè€…ä¸€æ®µé¼“å‹µçš„è©±ï¼‰

---
**è¨˜å¾—**ï¼šè³½çˆ¾ç‰¹åå­—å±•ç¤ºçš„æ˜¯ä¸€å€‹å®Œæ•´çš„ç”Ÿå‘½åˆ‡é¢ã€‚å®ƒä¸æ˜¯å‘½é‹çš„å®£åˆ¤ï¼Œè€Œæ˜¯ä¸€å¼µåœ°åœ–ï¼Œå¹«åŠ©ä½ çœ‹æ¸…ç•¶å‰ä½ç½®èˆ‡å¯èƒ½çš„é“è·¯ã€‚æœ€çµ‚çš„é¸æ“‡ï¼Œæ°¸é åœ¨ä½ æ‰‹ä¸­ã€‚
"""
    return prompt


def get_relationship_prompt(reading: TarotReading) -> str:
    """é—œä¿‚ç‰Œé™£è§£è®€ Prompt"""
    calculator = TarotCalculator()
    
    cards_info = []
    for i, card in enumerate(reading.cards):
        card_meaning = calculator.get_card_meaning(card.id, card.is_reversed, "love")
        orientation = "é€†ä½" if card.is_reversed else "æ­£ä½"
        cards_info.append(f"""
### {i+1}. {card.position}
**{card.name}ï¼ˆ{orientation}ï¼‰**
- é—œéµè©ï¼š{', '.join(card_meaning.get('keywords', []))}
- æ„Ÿæƒ…ç‰Œç¾©ï¼š{card_meaning.get('meaning', '')}""")
    
    prompt = f"""è«‹ç‚ºä»¥ä¸‹é—œä¿‚ç‰Œé™£æä¾›å®Œæ•´çš„æ„Ÿæƒ…è§£è®€ã€‚

ã€å•é¡Œã€‘{reading.question or "è«‹è§£è®€æˆ‘å€‘çš„é—œä¿‚"}
ã€ç‰Œé™£ã€‘é—œä¿‚ç‰Œé™£ï¼ˆå…­å¼µç‰Œï¼‰

{''.join(cards_info)}

---

è«‹æä¾›ä»¥ä¸‹è§£è®€ï¼š

## ğŸ’• é—œä¿‚æ¦‚è¦½
ï¼ˆ300-400å­—ï¼Œæè¿°é€™æ®µé—œä¿‚çš„æ•´é«”èƒ½é‡èˆ‡èµ°å‘ï¼‰

## ğŸ‘¤ ä½ çš„ç‹€æ…‹
ï¼ˆä½ åœ¨é€™æ®µé—œä¿‚ä¸­çš„æ„Ÿå—ã€æ…‹åº¦èˆ‡æœŸæœ›ï¼‰

## ğŸ‘¥ å°æ–¹çš„ç‹€æ…‹
ï¼ˆå°æ–¹åœ¨é€™æ®µé—œä¿‚ä¸­å¯èƒ½çš„æ„Ÿå—èˆ‡æ…‹åº¦ï¼‰

## ğŸ›ï¸ é—œä¿‚åŸºç¤
ï¼ˆé€™æ®µé—œä¿‚å»ºç«‹åœ¨ä»€éº¼åŸºç¤ä¸Šï¼Ÿæœ‰ä»€éº¼å„ªå‹¢èˆ‡éš±æ†‚ï¼Ÿï¼‰

## âš¡ ä¸»è¦æŒ‘æˆ°
ï¼ˆä½ å€‘éœ€è¦é¢å°çš„æœ€å¤§æŒ‘æˆ°æ˜¯ä»€éº¼ï¼Ÿï¼‰

## ğŸ’¡ é—œä¿‚å»ºè­°
ï¼ˆç‰Œå¡çµ¦äºˆçš„å»ºè­°æ˜¯ä»€éº¼ï¼Ÿï¼‰

## ğŸ”® æœªä¾†èµ°å‘
ï¼ˆå¦‚æœç¶­æŒç•¶å‰æ¨¡å¼ï¼Œé€™æ®µé—œä¿‚æœƒå¦‚ä½•ç™¼å±•ï¼Ÿï¼‰

## ğŸ¯ å…·é«”è¡Œå‹•
ï¼ˆ5 å€‹å¯ä»¥æ”¹å–„é—œä¿‚çš„å…·é«”è¡Œå‹•ï¼‰

## ğŸ’¬ å°ä½ èªªçš„è©±
ï¼ˆçµ¦å•åœè€…çš„æš–å¿ƒè©±èªï¼‰

---
**è¨˜å¾—**ï¼šå¡”ç¾…åªèƒ½åæ˜ ç•¶ä¸‹çš„èƒ½é‡ç‹€æ…‹ã€‚é—œä¿‚æ˜¯å…©å€‹äººçš„èˆè¹ˆï¼Œéœ€è¦é›™æ–¹å…±åŒåŠªåŠ›ã€‚
"""
    return prompt


def get_decision_prompt(reading: TarotReading) -> str:
    """æ±ºç­–ç‰Œé™£è§£è®€ Prompt"""
    calculator = TarotCalculator()
    
    cards_info = []
    for i, card in enumerate(reading.cards):
        card_meaning = calculator.get_card_meaning(card.id, card.is_reversed)
        orientation = "é€†ä½" if card.is_reversed else "æ­£ä½"
        cards_info.append(f"""
### {i+1}. {card.position}
**{card.name}ï¼ˆ{orientation}ï¼‰**
- é—œéµè©ï¼š{', '.join(card_meaning.get('keywords', []))}
- ç‰Œç¾©ï¼š{card_meaning.get('meaning', '')}""")
    
    prompt = f"""è«‹ç‚ºä»¥ä¸‹æ±ºç­–ç‰Œé™£æä¾›åˆ†æï¼Œå¹«åŠ©å•åœè€…åšå‡ºé¸æ“‡ã€‚

ã€å•é¡Œã€‘{reading.question or "æˆ‘è©²é¸æ“‡ A é‚„æ˜¯ Bï¼Ÿ"}
ã€ç‰Œé™£ã€‘æ±ºç­–ç‰Œé™£ï¼ˆä¸ƒå¼µç‰Œï¼‰

{''.join(cards_info)}

---

è«‹æä¾›ä»¥ä¸‹åˆ†æï¼š

## âš–ï¸ æ±ºç­–æ¦‚è¦½
ï¼ˆ200-300å­—ï¼Œæ¦‚è¿°é€™å€‹æ±ºç­–çš„æ ¸å¿ƒè€ƒé‡ï¼‰

## ğŸ…°ï¸ é¸æ“‡ A åˆ†æ

### çµæœé æ¸¬
ï¼ˆé¸æ“‡ A å¯èƒ½å¸¶ä¾†çš„çµæœï¼‰

### å„ªé»
ï¼ˆé¸æ“‡ A çš„æ­£é¢å½±éŸ¿ï¼‰

### é¢¨éšª
ï¼ˆé¸æ“‡ A éœ€è¦æ³¨æ„çš„é¢¨éšªï¼‰

### é©åˆç¨‹åº¦ï¼šâ­â­â­â­â­ /5

## ğŸ…±ï¸ é¸æ“‡ B åˆ†æ

### çµæœé æ¸¬
ï¼ˆé¸æ“‡ B å¯èƒ½å¸¶ä¾†çš„çµæœï¼‰

### å„ªé»
ï¼ˆé¸æ“‡ B çš„æ­£é¢å½±éŸ¿ï¼‰

### é¢¨éšª
ï¼ˆé¸æ“‡ B éœ€è¦æ³¨æ„çš„é¢¨éšªï¼‰

### é©åˆç¨‹åº¦ï¼šâ­â­â­â­â­ /5

## ğŸ“Š æ¯”è¼ƒè¡¨
| ç¶­åº¦ | é¸æ“‡ A | é¸æ“‡ B |
|------|--------|--------|
| çŸ­æœŸå½±éŸ¿ | | |
| é•·æœŸç™¼å±• | | |
| æƒ…æ„Ÿæ»¿è¶³ | | |
| å¯¦éš›æ”¶ç›Š | | |
| é¢¨éšªç¨‹åº¦ | | |

## ğŸ¯ æ•´é«”å»ºè­°
ï¼ˆæ ¹æ“šç‰Œé™£çµ¦å‡ºçš„æ•´é«”å»ºè­°ï¼Œå“ªå€‹é¸æ“‡æ›´é©åˆå•åœè€…ï¼Ÿç‚ºä»€éº¼ï¼Ÿï¼‰

## ğŸ’¡ ç¬¬ä¸‰é¸é …
ï¼ˆæ˜¯å¦æœ‰ç‰Œé™£æš—ç¤ºçš„ç¬¬ä¸‰ç¨®å¯èƒ½æ€§ï¼Ÿï¼‰

## ğŸ”‘ é—œéµè€ƒé‡
ï¼ˆåšæ±ºå®šå‰éœ€è¦æ€è€ƒçš„ 3 å€‹é—œéµå•é¡Œï¼‰

---
**è¨˜å¾—**ï¼šå¡”ç¾…ç‰Œæ˜¯æ±ºç­–è¼”åŠ©å·¥å…·ï¼Œä¸æ˜¯æ±ºç­–æœ¬èº«ã€‚æœ€çµ‚çš„é¸æ“‡æ¬Šåœ¨ä½ æ‰‹ä¸­ã€‚è†è½ä½ çš„å…§å¿ƒï¼Œå®ƒå¾€å¾€çŸ¥é“ç­”æ¡ˆã€‚
"""
    return prompt


# ==================== ä¸»è¦å‡½æ•¸ ====================

def generate_tarot_prompt(
    reading: TarotReading,
    context: str = "general"
) -> Dict[str, str]:
    """
    ç”Ÿæˆå¡”ç¾…ç‰Œè§£è®€ Prompt
    
    Args:
        reading: TarotReading ç‰©ä»¶
        context: å•é¡Œæƒ…å¢ƒï¼ˆgeneral, love, career, finance, healthï¼‰
    
    Returns:
        åŒ…å« system_prompt å’Œ user_prompt çš„å­—å…¸
    """
    spread_type = reading.spread_type
    
    # æ ¹æ“šç‰Œé™£é¡å‹é¸æ“‡å°æ‡‰æ¨¡æ¿
    if spread_type == "single":
        user_prompt = get_single_card_prompt(reading, context)
    elif spread_type == "three_card":
        user_prompt = get_three_card_prompt(reading, context)
    elif spread_type == "celtic_cross":
        user_prompt = get_celtic_cross_prompt(reading, context)
    elif spread_type == "relationship":
        user_prompt = get_relationship_prompt(reading)
    elif spread_type == "decision":
        user_prompt = get_decision_prompt(reading)
    else:
        # é è¨­ä½¿ç”¨ä¸‰å¼µç‰Œæ¨¡æ¿
        user_prompt = get_three_card_prompt(reading, context)
    
    return {
        "system_prompt": TAROT_SYSTEM_PROMPT,
        "user_prompt": user_prompt
    }


def main():
    """æ¸¬è©¦ Prompt ç”Ÿæˆ"""
    from tarot_calculator import TarotCalculator
    
    print("=" * 60)
    print("å¡”ç¾…ç‰Œ Prompt æ¨¡æ¿æ¸¬è©¦")
    print("=" * 60)
    
    calculator = TarotCalculator()
    
    # æ¸¬è©¦å–®å¼µç‰Œ
    print("\nã€æ¸¬è©¦ 1ã€‘å–®å¼µç‰Œ Prompt")
    print("-" * 40)
    reading = calculator.draw_cards("single", "ä»Šå¤©çš„æ„›æƒ…æŒ‡å¼•", seed=42)
    prompts = generate_tarot_prompt(reading, "love")
    print(f"System Prompt é•·åº¦ï¼š{len(prompts['system_prompt'])} å­—")
    print(f"User Prompt é•·åº¦ï¼š{len(prompts['user_prompt'])} å­—")
    print("\n--- User Prompt é è¦½ ---")
    print(prompts['user_prompt'][:800] + "...")
    
    # æ¸¬è©¦ä¸‰å¼µç‰Œ
    print("\n\nã€æ¸¬è©¦ 2ã€‘ä¸‰å¼µç‰Œ Prompt")
    print("-" * 40)
    reading = calculator.draw_cards("three_card", "æˆ‘çš„äº‹æ¥­ç™¼å±•å¦‚ä½•ï¼Ÿ", seed=123)
    prompts = generate_tarot_prompt(reading, "career")
    print(f"User Prompt é•·åº¦ï¼š{len(prompts['user_prompt'])} å­—")
    print("\n--- User Prompt é è¦½ ---")
    print(prompts['user_prompt'][:800] + "...")
    
    # æ¸¬è©¦è³½çˆ¾ç‰¹åå­—
    print("\n\nã€æ¸¬è©¦ 3ã€‘è³½çˆ¾ç‰¹åå­— Prompt")
    print("-" * 40)
    reading = calculator.draw_cards("celtic_cross", "æˆ‘è©²ä¸è©²å‰µæ¥­ï¼Ÿ", seed=456)
    prompts = generate_tarot_prompt(reading, "career")
    print(f"User Prompt é•·åº¦ï¼š{len(prompts['user_prompt'])} å­—")
    
    print("\n\nâœ… Prompt æ¨¡æ¿æ¸¬è©¦å®Œæˆï¼")


if __name__ == "__main__":
    main()
